---
title: http/1.1
date: 2021-04-10 08:40:45
categories: HTTP
order: 2
tags:
  - JavaScript
  - http
---


## http1.1 的优点

---

1. 简单

- 一个基本的 http 报文格式为 `header + body`，头部信息也是 `key-value` 简单文本的形式，易于理解，降低了学习和使用的门槛

2. 灵活和易于扩展

- HTTP 协议里的各类请求方法、URI/URL、状态码、头字段等每个组成要求都没有被固定死，都允许开发人员自定义和扩充
- 同时 HTTP 由于是工作在应用层（ OSI 第七层），则它下层可以随意变化
- `https` 也就是在 `HTTP` 与 `TCP` 层之间增加了 `SSL/TLS` 安全传输层，`HTTP/3` 甚至把 `TCP` 层换成了基于 `UDP` 的 `QUIC`

3. 应用广泛和跨平台

- 互联网发展至今，HTTP 的应用范围非常的广泛，各式各样的网页、应用等

---

## http1.1 的缺点

---

1. 无状态

- 好处：服务器不会去记忆 HTTP 的状态，因此不需要额外的资源来记录状态信息，这能减轻服务器的负担，能够把更多的 CPU 和内存用来对外提供服务
- 坏处：服务器没有记忆能力，它在完成有关联性的操作时会非常麻烦。但是我们可以在请求和响应报文中写入 `cookie` 来控制客户端的状态
- `cookie`：在客户端第一次请求后，服务器会下发一个装有客户信息的「小贴纸」，后续客户端请求服务器的时候，带上「小贴纸」，服务器就能认得了了

2. 明文传输

- 好处：这意味着传输过程中的信息是可阅读的，通过 `f12` 或抓包工具都可以查看到，因此也方便了我们的调试工作
- 坏处：传输过程中的信息全部暴露了出来，类似于信息裸奔。在传输过程中，信息的内容毫无隐私可言，很容易就被窃取到

3. 不安全

- 通信使用明文（不加密），内容可能会被窃听。例如账号信息容易泄露
- 不验证通信方的身份，因此有可能遭遇伪装。例如访问假的网站
- 无法证明报文的完整性，所以有可能已遭篡改。例如访问了植入了广告或恶意脚本的网页

---

## http1.1 的性能

---

1. http1.0 的问题

- 早期 htttp1.0 每发起一个请求，都要重新建立 tcp 连接。也就是说，每进行一次 http 通信，都需要经历建立 TCP 连接、传输 HTTP 数据和断开 TCP 连接三个阶段
- 在之前的时候，由于通信的文件比较小，并且每个页面的引用也不多，所以 http1.0 的传输方式是能满足需求的。但随着浏览器的普及，单个页面中的图片文件越来越多，有时候一个页面可能包含了几百个外部引用的资源文件，如果在下载每个文件的时候，都需要经历建立 TCP 连接、传输数据和断开连接这样的步骤，无疑会增加大量无谓的开销

2. http1.1的处理方式
- 为了解决 http1.0 的问题，http1.1 增加了 **长连接** 的通信方式，也叫 **持久连接**。它的特点 **是在一个 TCP 连接上可以传输多个 HTTP 请求，只要浏览器或者服务器没有明确提出断开连接，那么该 TCP 连接会一直保持。或者某个 http 连接超过一定时间没有任何数据交互，服务器会主动断开这个连接**

![](./img/longConnect.png)

- 这种方式可以有效减少 TCP 重复建立连接和断开连接的次数，减少了服务器额外的负担，并提升整体 HTTP 的请求时长

3. ~~管道网络传输~~
- 持久连接能够有效减少 tcp 的建立和断开次数，同一个 tcp 连接中的请求需要排队，后面的请求需要等待前面的请求返回了之后，才能进行下一次请求。如果 tcp 通道中的某个请求因为某些原因(如请求耗时较长、网络阻塞等)没有及时返回，那么就会阻塞后面的所有请求，这就是 **队头阻塞**
- http1.1 通过 **管线化** 的技术来解决队头阻塞的问题，它将多个 http 请求批量提交给服务器。这样就不用等待之前的请求响应，就可以发送第二个请求，减少了整体的响应时间
- 当客户端需要请求多个资源时。以前的方法是在同一个 tcp 连接里面，先发送 A 请求，然后等待服务器做出回应，收到后再发出 B 请求。管道机制则是允许浏览器同时发出 A 请求和 B 请求，但是服务器依然需要根据请求顺序来回复浏览器的请求
- 但实际上，管道机制并没有完全解决队头阻塞的问题，它只是解决了客户端的问题，而没有解决服务端的问题，服务端还是要以 **FIFO** 的形式进行返回。意思是 1 号请求的响应造成阻塞，2 号请求仍然要等 1 号请求处理完并且返回后才会响应给客户端
- 因此，实际上 http/1.1 管道化技术不是默认开启，而且浏览器基本都没有支持

4. 虚拟主机的支持
- 早期的 http1.0 中，每个域名绑定的是唯一的 IP 地址，因此服务器只能支持一个域名。但是随着虚拟主机技术的发展，需要实现在一台物理主机上绑定多个虚拟主机，每个虚拟主机都有自己的单独的域名，这些单独的域名都公用同一个 IP 地址
- http1.1 通过请求头的中 Host 字段来表示当前的域名地址，这样服务器就可以根据不同的 Host 值做不同的处理

5. 支持动态内容生成
- http1.0 中，浏览器在接受一个请求时，需要根据请求头中设置完整的数据大小，也就是 Content-Length:xxx 来接收数据。但随着网络的发展，很多页面的内容都是动态生成的，所以在传输数据之前并不知道最终的数据大小，这会导致浏览器不知道何时会接收完所有的文件数据
- http1.1 通过引入 Chunk transfer 机制来解决这个问题，服务器会将数据分割成若干个任意大小的数据块，每个数据块发送时会附上上个数据块的长度，最后使用一个零长度的块作为发送数据完成的标志。这样就提供了对动态内容的支持


